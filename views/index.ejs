
<div class="container bootstrap snippet">
  <div class="row">
  <div class="col-md-4 bg-white ">
          <div class=" row border-bottom padding-sm" style="height: 40px;">
            Members
          </div>

          <!-- =============================================================== -->
          <!-- member list -->
          <ul class="friend-list">
            <% users.forEach((user) => { %>
              <li>
                <h3><%= user.local.name %></h3>
                <p><%= user.local.email %></p>
              </li>
            <% }) %>
              <li>
                  <a href="#" class="clearfix">
                  <img src="https://bootdey.com/img/Content/user_2.jpg" alt="" class="img-circle">
                  <div class="friend-name">
                    <strong>Jane Doe</strong>
                  </div>
                  <div class="last-message text-muted">Lorem ipsum dolor sit amet.</div>
                  <small class="time text-muted">5 mins ago</small>
                <small class="chat-alert text-muted"><i class="fa fa-check"></i></small>
                </a>
              </li>
          </ul>
</div>

      <!--=========================================================-->
      <!-- selected chat -->
<div class="col-md-8 bg-white ">
  <div class="chat-message">
    <ul class="chat">
      <ul id="messages"></ul>
        <div id="feedback">
        </div>
          <li class="right clearfix">
            <span class="chat-img pull-right">
              <img src="https://bootdey.com/img/Content/user_1.jpg" alt="User Avatar">
            </span>
            <div class="chat-body clearfix">
              <div class="header">
                <strong class="primary-font">Sarah</strong>
                <small class="pull-right text-muted"><i class="fa fa-clock-o"></i> 13 mins ago</small>
              </div>
              <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur bibendum ornare dolor, quis ullamcorper ligula sodales at.
              </p>
            </div>
          </li>
        </ul>
      </div>




      <div class="chat-box bg-white">
        <div class="input-group">
          <form>
            <% if(loggedIn) { %>
            <input id='m' autocomplete='off' class="form-control border no-shadow no-rounded" />
            <button class="btn btn-success no-rounded">Send</button>
            <% } %>
          </form>
        </div><!-- /input-group -->
      </div>
    </div>
  </div>
</div>

<script>
$(function () {
  var feedback = document.getElementById('feedback');
  var messages = document.getElementById('messages');
  var socket = io()

  $('form').submit(function(){
     socket.emit('chat message', {message: $('#m').val(), _user: '<%= currentUser.local.name %>' });
     $('#m').val('')
     return false
  })

  socket.on('chat message', function(msg){
    $('#messages').append('<li class="right clearfix"><span class="chat-img pull-right"><img src="https://bootdey.com/img/Content/user_1.jpg" alt="User Avatar"></span><div class="chat-body clearfix"><div class="header"><strong class="primary-font"><%= currentUser.local.name %></strong><small class="pull-right text-muted"><i class="fa fa-clock-o"></i> 13 mins ago</small></div><p>' +  msg.message + '</p></div></li>')
  })
  // $('<li>').text(msg._user + ': ' + msg.message )
  //user is typing..
  messages.addEventListener('keypress', function() {
    socket.emit('typing')
  })

  function addMessage(msg) {
    $('#messages').append('<li class="right clearfix"><span class="chat-img pull-right"><img src="https://bootdey.com/img/Content/user_1.jpg" alt="User Avatar"></span><div class="chat-body clearfix"><div class="header"><strong class="primary-font"><%= currentUser.local.name %></strong><small class="pull-right text-muted"><i class="fa fa-clock-o"></i> 13 mins ago</small></div><p>' +  msg.message + '</p></div></li>')
  }

  socket.on('load old chats', function(docs) {
    for (i=docs.length-1; i >= 0; i--) {
      addMessage(docs[i])
    }
  })
})

</script>
